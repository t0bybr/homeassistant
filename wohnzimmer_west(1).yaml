# =========================================================
# README Â· Blinds/LOGO â€“ Helpers + Template-Cover + Blueprint-Use
# ---------------------------------------------------------
# Ziel
# - Einheitliche, sprechende Helper-Namen
# - Template-Cover zeigt Tilt-Slider, fÃ¤hrt aber NICHT selbst per Tilt.
#   -> set_tilt_position schreibt NUR einen UI-Helper.
#   -> Der BLUEPRINT reagiert auf den Cover-Tilt (Attribut) und ruft
#      util_blinds_tilt_step_ticks_dir mit den KALIBRIER-WERTEN aus dem Blueprint.
# - set_cover_position fÃ¤hrt Prozentâ†’Ticks und nutzt Klartext-Variablen.
#
# Wo kalibrieren?
# - Die vier Tilt-Schrittwerte (Ticks) werden EINMAL im Blueprint gesetzt:
#   var_open_step_ticks_at_closed / var_open_step_ticks_at_open
#   var_close_step_ticks_at_closed / var_close_step_ticks_at_open
#
# Hinweis
# - Die BestÃ¤tigung â€ž10000â€œ am Fahrtende passiert in der Automation (Status 2/3â†’0/1).
# - Dieses File definiert NUR die EntitÃ¤ten + Template-Cover.
# =========================================================

input_boolean:
  blinds_0_living_room_west_counting:
  blinds_0_living_room_west_tilted:

input_number:
  blinds_0_living_room_west_max_travel_ticks:
    min: 0
    max: 999
    mode: box
    step: 1

  blinds_0_living_room_west_position_backup:
    min: 0
    max: 999
    mode: box
    step: 1

  blinds_0_living_room_west_logo_register_counter:
    min: 0
    max: 999
    mode: box
    step: 1

  blinds_0_living_room_west_logo_register_target:
    min: 0
    max: 9999
    mode: box
    step: 1

  blinds_0_living_room_west_logo_coil_up:
    min: 0
    max: 9999
    mode: box
    step: 1

  blinds_0_living_room_west_logo_coil_down:
    min: 0
    max: 9999
    mode: box
    step: 1

  # 2 = closing/runter, 3 = opening/hoch
  blinds_0_living_room_west_last_moving_state:
    min: 0
    max: 3
    mode: box
    step: 1

  # UI-Slider fÃ¼r Tilt (nur Parameter; kein direktes Fahren)
  blinds_0_living_room_west_tilt_ui:
    min: 0
    max: 100
    mode: box
    step: 1

counter:
  blinds_0_living_room_west_clicks:
    initial: 0

input_text:
  blinds_0_living_room_west_last_direction_text:

automation:
  - use_blueprint:
      path: t0bybr/blinds.yaml
      input:
        name: "living_room_west"
        floor: "0"

        cover_entity: cover.blinds_0_living_room_west
        tilt_flag_entity: input_boolean.blinds_0_living_room_west_tilted

        up_button_entity_id: binary_sensor.mosquitto_broker_mqtt_logo_coil_9
        down_button_entity_id: binary_sensor.mosquitto_broker_mqtt_logo_coil_8

        position_ticks_sensor_entity_id: sensor.mosquitto_broker_mqtt_logo_hr_104_position_raw
        movement_status_sensor_entity_id: sensor.mosquitto_broker_mqtt_logo_hr_104_status

        coil_up: 8303
        coil_down: 8304
        register_target: 535
        register_max_ticks_limit: 534
        register_counter: 20
        max_travel_ticks: 552

        # Kalibrierung (Ticks)
        open_step_ticks_at_closed: 12
        open_step_ticks_at_open: 9
        close_step_ticks_at_closed: 10
        close_step_ticks_at_open: 6
        min_step_ticks: 2

cover:
  - platform: template
    covers:
      blinds_0_living_room_west:
        friendly_name: "Jalousie Wohnzimmer West"
        unique_id: "blinds_0_living_room_west"

        # Prozent-Position aus Ticks
        position_template: >
          {% set max_travel_ticks = states('input_number.blinds_0_living_room_west_max_travel_ticks') | int(1) %}
          {% set current_ticks    = states('sensor.mosquitto_broker_mqtt_logo_hr_104_position_raw') | float(0) %}
          {% if max_travel_ticks > 0 %}
            {{ (current_ticks / max_travel_ticks * 100) | round(0) }}
          {% else %}
            0
          {% endif %}

        # Status aus LOGO (0/1/2/3)
        value_template: >
          {% set s = states('sensor.mosquitto_broker_mqtt_logo_hr_104_status') | int(0) %}
          {% if   s == 1 %} open
          {% elif s == 3 %} opening
          {% elif s == 2 %} closing
          {% else        %} closed
          {% endif %}

        # --- Ã–ffnen (auf 100% Ticks) ---
        open_cover:
          sequence:
            - action: mqtt.publish
              data:
                topic: "logo/register/set/{{ states('input_number.blinds_0_living_room_west_logo_register_target') | int }}"
                payload: "10000"
            - delay: "00:00:0.2"
            - action: mqtt.publish
              data:
                topic: "logo/register/set/{{ states('input_number.blinds_0_living_room_west_logo_register_target') | int }}"
                payload: "{{ states('input_number.blinds_0_living_room_west_max_travel_ticks') | int }}"

        # --- SchlieÃŸen (auf 0 Ticks) ---
        close_cover:
          sequence:
            - action: mqtt.publish
              data:
                topic: "logo/register/set/{{ states('input_number.blinds_0_living_room_west_logo_register_target') | int }}"
                payload: "10000"
            - delay: "00:00:0.2"
            - action: mqtt.publish
              data:
                topic: "logo/register/set/{{ states('input_number.blinds_0_living_room_west_logo_register_target') | int }}"
                payload: "0"

        # --- Stop (10000 bestÃ¤tigen) ---
        stop_cover:
          sequence:
            - action: mqtt.publish
              data:
                topic: "logo/register/set/{{ states('input_number.blinds_0_living_room_west_logo_register_target') | int }}"
                payload: "10000"

        # --- Setzen einer absoluten Position in % (â†’ Ticks) ---
        set_cover_position:
          sequence:
            - variables:
                max_travel_ticks: "{{ states('input_number.blinds_0_living_room_west_max_travel_ticks') | int(1) }}"
                target_ticks: "{{ (position | float(0) / 100 * max_travel_ticks) | int(0) }}"
            - action: mqtt.publish
              data:
                topic: "logo/register/set/{{ states('input_number.blinds_0_living_room_west_logo_register_target') | int }}"
                payload: "{{ target_ticks | int }}"
            # Hinweis: '10000'-BestÃ¤tigung erfolgt im Blueprint bei 2/3â†’0/1

        # --- Tilt-Slider: nur UI/Parameter; keine direkte Fahrt ---
        tilt_template: "{{ states('input_number.blinds_0_living_room_west_tilt_ui') | int(0) }}"
        set_cover_tilt_position:
          sequence:
            - action: input_number.set_value
              target:
                entity_id: input_number.blinds_0_living_room_west_tilt_ui
              data:
                value: "{{ tilt | int }}"
            # Kein Fahren hier â€“ der Blueprint reagiert auf das Cover-Attribut

script:
  testimctestface:
    sequence:
      - action: mqtt.publish
        data:
          topic: "logo/register/set/{{ states('input_number.blinds_0_living_room_west_logo_register_target') | int }}"
          payload: "{{ ((states('sensor.mosquitto_broker_mqtt_logo_hr_104_position_raw') | float(0)) + (states('input_number.test_up_num') | float(0))) | int(0) }}"
      - delay: "00:00:02"
      - action: mqtt.publish
        data:
          topic: "logo/register/set/{{ states('input_number.blinds_0_living_room_west_logo_register_target') | int }}"
          payload: "{{ ((states('sensor.mosquitto_broker_mqtt_logo_hr_104_position_raw') | float(0)) + (states('input_number.test_down_num') | float(0))) | int(0) }}"
      # - action: mqtt.publish
      #   data:
      #     topic: "logo/coil/set/8303"
      #     payload: "ON"
      # - delay: "00:00:.2"
      # - action: mqtt.publish
      #   data:
      #     topic: "logo/coil/set/8303"
      #     payload: "OFF"
# ###############################################################################
# # ðŸªŸ JALOUSIE WOHNZIMMER WEST
# # Siemens LOGO â€“ MQTT-Steuerung
# ###############################################################################

# input_boolean:
#   taster_jalousie_wohnzimmer_west_counting:
#     name: "Jalousie West - Taster Zeitfenster aktiv"
#     initial: off
#     icon: mdi:timer
#   jalousie_wohnzimmer_west_tilted:
#     name: "Jalousie Wohnzimmer West - Geneigt"
#     initial: off

# input_number:
#   jalousie_wohnzimmer_west_last_state:
#     name: "Jalousie Wohnzimmer West - Letzter Status"
#     min: 2
#     max: 3
#     initial: 2
#     step: 1

# counter:
#   jalousie_wohnzimmer_west_counter:
#     initial: 0
#     step: 1
#     icon: mdi:counter

# input_text:
#   jalousie_wohnzimmer_west_last_direction:
#     name: "Letzte Richtung"

# ###############################################################################
# # ðŸ§© SCRIPTS
# ###############################################################################

# script:
#   jalousie_wohnzimmer_west_restore_tilt_position:
#     alias: "Jalousie Wohnzimmer West â€“ Neigung wiederherstellen"
#     mode: restart
#     sequence:
#       - if:
#           - condition: state
#             entity_id: input_boolean.jalousie_wohnzimmer_west_tilted
#             state: "on"
#           - condition: numeric_state
#             entity_id: cover.jalousie_wohnzimmer_west
#             attribute: current_position
#             above: -1
#             below: 95
#         then:
#           - delay: "00:00:02" # etwas warten, bis Fahrt abgeschlossen
#           - choose:
#               - conditions: "{{ is_state('input_number.jalousie_wohnzimmer_west_last_state', '3.0') }}"
#                 sequence:
#                   - action: mqtt.publish
#                     data:
#                       topic: "logo/coil/set/8304"
#                       payload: "ON"
#                   - delay: "00:00:1.38"
#                   - action: mqtt.publish
#                     data:
#                       topic: "logo/coil/set/8304"
#                       payload: "OFF"
#                   - delay: "00:00:0.6"
#                   - action: mqtt.publish
#                     data:
#                       topic: "logo/coil/set/8303"
#                       payload: "ON"
#                   - delay: "00:00:01"
#                   - action: mqtt.publish
#                     data:
#                       topic: "logo/coil/set/8303"
#                       payload: "OFF"
#                   - delay: "00:00:0.3"
#               - conditions: "{{ is_state('input_number.jalousie_wohnzimmer_west_last_state', '2.0') }}"
#                 sequence:
#                   - action: mqtt.publish
#                     data:
#                       topic: "logo/coil/set/8303"
#                       payload: "ON"
#                   - delay: "00:00:01"
#                   - action: mqtt.publish
#                     data:
#                       topic: "logo/coil/set/8303"
#                       payload: "OFF"
#                   - delay: "00:00:0.3"

#   jalousie_wohnzimmer_west_set_tilt:
#     alias: "Jalousie Wohnzimmer West - Neigung umschalten"
#     mode: restart
#     sequence:
#       - action: mqtt.publish
#         data:
#           topic: "logo/register/set/535"
#           payload: "10000"
#       - delay: "00:00:0.2"
#       - choose:
#           - conditions: "{{ is_state('input_boolean.jalousie_wohnzimmer_west_tilted', 'off') and is_state('input_number.jalousie_wohnzimmer_west_last_state', '3.0') }}"
#             sequence:
#               - action: mqtt.publish
#                 data:
#                   topic: "logo/coil/set/8304"
#                   payload: "ON"
#               - delay: "00:00:1.38"
#               - action: mqtt.publish
#                 data:
#                   topic: "logo/coil/set/8304"
#                   payload: "OFF"
#               - delay: "00:00:0.6"
#               - action: mqtt.publish
#                 data:
#                   topic: "logo/coil/set/8303"
#                   payload: "ON"
#               - delay: "00:00:01"
#               - action: mqtt.publish
#                 data:
#                   topic: "logo/coil/set/8303"
#                   payload: "OFF"
#               - delay: "00:00:0.3"
#           - conditions: "{{ is_state('input_boolean.jalousie_wohnzimmer_west_tilted', 'off') and is_state('input_number.jalousie_wohnzimmer_west_last_state', '2.0') }}"
#             sequence:
#               - action: mqtt.publish
#                 data:
#                   topic: "logo/coil/set/8303"
#                   payload: "ON"
#               - delay: "00:00:01"
#               - action: mqtt.publish
#                 data:
#                   topic: "logo/coil/set/8303"
#                   payload: "OFF"
#               - delay: "00:00:0.3"
#           - conditions: "{{ is_state('input_boolean.jalousie_wohnzimmer_west_tilted', 'on') and is_state('input_number.jalousie_wohnzimmer_west_last_state', '3.0') }}"
#             sequence:
#               - action: mqtt.publish
#                 data:
#                   topic: "logo/coil/set/8304"
#                   payload: "ON"
#               - delay: "00:00:01"
#               - action: mqtt.publish
#                 data:
#                   topic: "logo/coil/set/8304"
#                   payload: "OFF"
#               - delay: "00:00:0.6"
#               - action: mqtt.publish
#                 data:
#                   topic: "logo/coil/set/8303"
#                   payload: "ON"
#               - delay: "00:00:1.38"
#               - action: mqtt.publish
#                 data:
#                   topic: "logo/coil/set/8303"
#                   payload: "OFF"
#               - delay: "00:00:0.3"
#           - conditions: "{{ is_state('input_boolean.jalousie_wohnzimmer_west_tilted', 'on') and is_state('input_number.jalousie_wohnzimmer_west_last_state', '2.0') }}"
#             sequence:
#               - action: mqtt.publish
#                 data:
#                   topic: "logo/coil/set/8304"
#                   payload: "ON"
#               - delay: "00:00:01"
#               - action: mqtt.publish
#                 data:
#                   topic: "logo/coil/set/8304"
#                   payload: "OFF"
#               - delay: "00:00:0.3"

#   jalousie_wohnzimmer_west_set_tilt_state:
#     alias: "Jalousie Wohnzimmer West - Neigung Status setzen"
#     mode: restart
#     sequence:
#       - choose:
#           - conditions: "{{ is_state('input_boolean.jalousie_wohnzimmer_west_tilted', 'off') and is_state('input_number.jalousie_wohnzimmer_west_last_state', '3.0') }}"
#             sequence:
#               - delay: "00:00:3.28"
#               - action: input_boolean.turn_on
#                 target:
#                   entity_id: input_boolean.jalousie_wohnzimmer_west_tilted
#           - conditions: "{{ is_state('input_boolean.jalousie_wohnzimmer_west_tilted', 'off') and is_state('input_number.jalousie_wohnzimmer_west_last_state', '2.0') }}"
#             sequence:
#               - delay: "00:00:1.3"
#               - action: input_boolean.turn_on
#                 target:
#                   entity_id: input_boolean.jalousie_wohnzimmer_west_tilted
#           - conditions: "{{ is_state('input_boolean.jalousie_wohnzimmer_west_tilted', 'on') and is_state('input_number.jalousie_wohnzimmer_west_last_state', '3.0') }}"
#             sequence:
#               - delay: "00:00:3.28"
#               - action: input_boolean.turn_off
#                 target:
#                   entity_id: input_boolean.jalousie_wohnzimmer_west_tilted
#           - conditions: "{{ is_state('input_boolean.jalousie_wohnzimmer_west_tilted', 'on') and is_state('input_number.jalousie_wohnzimmer_west_last_state', '2.0') }}"
#             sequence:
#               - delay: "00:00:1.3"
#               - action: input_boolean.turn_off
#                 target:
#                   entity_id: input_boolean.jalousie_wohnzimmer_west_tilted

#   jalousie_wohnzimmer_west_handle_press:
#     alias: "Handle Press (Hoch/Runter)"
#     mode: parallel
#     sequence:
#       - variables:
#           button_entity: >
#             {{ 'binary_sensor.mosquitto_broker_mqtt_logo_coil_9' if is_up else 'binary_sensor.mosquitto_broker_mqtt_logo_coil_8' }}

#       # Kurz vs. Langdruck: 0.6 s Schwelle
#       - wait_template: "{{ is_state(button_entity, 'off') }}"
#         timeout: "00:00:0.6"
#         continue_on_timeout: true

#       - choose:
#           # Langdruck (Timeout erreicht -> nicht losgelassen)
#           - conditions: "{{ not wait.completed }}"
#             sequence:
#               - action: script.turn_on
#                 target:
#                   entity_id: script.jalousie_wohnzimmer_west_longpress
#                 data:
#                   variables:
#                     is_up: "{{ is_up }}"

#           # Kurz-/Mehrfachklick (innerhalb 0.6 s losgelassen)
#           - conditions: "{{ wait.completed }}"
#             sequence:
#               - action: script.turn_on
#                 target:
#                   entity_id: script.jalousie_wohnzimmer_west_counter_click
#                 data:
#                   variables:
#                     is_up: "{{ is_up }}"

#   jalousie_wohnzimmer_west_longpress:
#     alias: "Langdrucksteuerung Motor"
#     sequence:
#       - variables:
#           coil: "{{ 8303 if is_up else 8304 }}"
#           btn: "{{ 'binary_sensor.mosquitto_broker_mqtt_logo_coil_9' if is_up else 'binary_sensor.mosquitto_broker_mqtt_logo_coil_8' }}"
#       - action: mqtt.publish
#         data:
#           topic: "logo/coil/set/{{ coil }}"
#           payload: "ON"
#       - wait_template: "{{ is_state(btn, 'off') }}"
#         timeout: "00:00:20"
#         continue_on_timeout: true
#       - delay: "00:00:0.2"
#       - action: mqtt.publish
#         data:
#           topic: "logo/coil/set/{{ coil }}"
#           payload: "OFF"
#       - action: script.turn_on
#         target:
#           entity_id: script.jalousie_wohnzimmer_west_restore_tilt_position

#   jalousie_wohnzimmer_west_counter_click:
#     alias: "ZÃ¤hllogik Hoch/Runter"
#     sequence:
#       - if:
#           - condition: state
#             entity_id: input_boolean.taster_jalousie_wohnzimmer_west_counting
#             state: "off"
#         then:
#           - action: input_boolean.turn_on
#             target:
#               entity_id: input_boolean.taster_jalousie_wohnzimmer_west_counting
#           - action: input_text.set_value
#             target:
#               entity_id: input_text.jalousie_wohnzimmer_west_last_direction
#             data:
#               value: "{{ 'hoch' if is_up else 'runter' }}"
#           - action: script.turn_on
#             target:
#               entity_id: script.jalousie_wohnzimmer_west_counter_window

#       - action: counter.increment
#         target:
#           entity_id: counter.jalousie_wohnzimmer_west_counter

#   jalousie_wohnzimmer_west_counter_window:
#     alias: "ZÃ¤hlfenster Wohnzimmer West"
#     sequence:
#       - delay: "00:00:02"
#       - variables:
#           count: "{{ states('counter.jalousie_wohnzimmer_west_counter') | int }}"
#           dir: "{{ states('input_text.jalousie_wohnzimmer_west_last_direction') }}"
#       - choose:
#           # --- Hoch-Taste ---
#           - conditions: "{{ dir == 'hoch' }}"
#             sequence:
#               - choose:
#                   - conditions: "{{ count == 1 }}"
#                     sequence:
#                       - action: cover.open_cover
#                         target:
#                           entity_id: cover.jalousie_wohnzimmer_west
#                   - conditions: "{{ count == 2 }}"
#                     sequence:
#                       - action: script.turn_on
#                         target:
#                           entity_id: script.jalousie_wohnzimmer_west_set_tilt
#                       - delay: "00:00:0.4"
#                       - action: script.turn_on
#                         target:
#                           entity_id: script.jalousie_wohnzimmer_west_set_tilt_state
#                   - conditions: "{{ count == 3 }}"
#                     sequence:
#                       - action: script.turn_on
#                         target:
#                           entity_id: script.farbverlauf_gruen_gelb_rot_llm
#           # --- Runter-Taste ---
#           - conditions: "{{ dir == 'runter' }}"
#             sequence:
#               - choose:
#                   - conditions: "{{ count == 1 }}"
#                     sequence:
#                       - action: cover.close_cover
#                         target:
#                           entity_id: cover.jalousie_wohnzimmer_west
#                   - conditions: "{{ count == 2 }}"
#                     sequence:
#                       - action: light.toggle
#                         target:
#                           entity_id: light.hue_color_lamp_1
#       - action: input_boolean.turn_off
#         target:
#           entity_id: input_boolean.taster_jalousie_wohnzimmer_west_counting
#       - action: counter.reset
#         target:
#           entity_id: counter.jalousie_wohnzimmer_west_counter

# ###############################################################################
# # ðŸ§  AUTOMATIONEN
# ###############################################################################

# automation:
#   - alias: "Jalousie Wohnzimmer West - Fahrdauer schreiben"
#     triggers:
#       - trigger: homeassistant
#         event: start
#     actions:
#       - action: mqtt.publish
#         data:
#           topic: "logo/register/set/534"
#           payload: "552"

#   - alias: "Jalousie Wohnzimmer West â€“ Sofort stoppen bei Bewegung"
#     mode: single
#     triggers:
#       - trigger: state
#         entity_id:
#           - binary_sensor.mosquitto_broker_mqtt_logo_coil_9
#           - binary_sensor.mosquitto_broker_mqtt_logo_coil_8
#         from: "off"
#         to: "on"
#     condition:
#       - condition: template
#         value_template: "{{ states('cover.jalousie_wohnzimmer_west') in ['opening', 'closing'] }}"
#     action:
#       - action: cover.stop_cover
#         target:
#           entity_id: cover.jalousie_wohnzimmer_west

#   - alias: "Jalousie Wohnzimmer West â€“ Tasterereignisse"
#     mode: parallel
#     triggers:
#       - trigger: state
#         entity_id:
#           - binary_sensor.mosquitto_broker_mqtt_logo_coil_9 # hoch
#           - binary_sensor.mosquitto_broker_mqtt_logo_coil_8 # runter
#         from: "off"
#         to: "on"
#     condition:
#       - condition: template
#         value_template: "{{ states('cover.jalousie_wohnzimmer_west') not in ['opening', 'closing'] }}"
#     action:
#       - variables:
#           is_up: "{{ trigger.entity_id == 'binary_sensor.mosquitto_broker_mqtt_logo_coil_9' }}"
#       - action: script.turn_on
#         target:
#           entity_id: script.jalousie_wohnzimmer_west_handle_press
#         data:
#           variables:
#             is_up: "{{ is_up }}"

# ###############################################################################
# # COVER â€“ Template
# ###############################################################################
# cover:
#   - platform: template
#     covers:
#       jalousie_wohnzimmer_west:
#         friendly_name: "Jalousie Wohnzimmer West"
#         unique_id: "jalousie_wohnzimmer_west"
#         position_template: >
#           {{ (states('sensor.mosquitto_broker_mqtt_logo_hr_104_position_raw') | float(0) / 552 * 100) | round(0) }}
#         value_template: >
#           {% set s = states('sensor.mosquitto_broker_mqtt_logo_hr_104_status') | int(0) %}
#           {% if s == 1 %}
#             open
#           {% elif s == 3 %}
#             opening
#           {% elif s == 2 %}
#             closing
#           {% else %}
#             closed
#           {% endif %}

#         # --- Hochfahren ---
#         open_cover:
#           sequence:
#             - action: mqtt.publish
#               data:
#                 topic: "logo/register/set/535"
#                 payload: "10000"
#             - delay: "00:00:0.2"
#             - action: mqtt.publish
#               data:
#                 topic: "logo/register/set/535"
#                 payload: "552"
#             - action: input_number.set_value
#               entity_id: input_number.jalousie_wohnzimmer_west_last_state
#               data:
#                 value: 3
#             - action: script.turn_on
#               target:
#                 entity_id: script.jalousie_wohnzimmer_west_restore_tilt_position

#         # --- Runterfahren ---
#         close_cover:
#           sequence:
#             - action: mqtt.publish
#               data:
#                 topic: "logo/register/set/535"
#                 payload: "10000"
#             - delay: "00:00:0.2"
#             - action: mqtt.publish
#               data:
#                 topic: "logo/register/set/535"
#                 payload: "0"
#             - action: input_number.set_value
#               entity_id: input_number.jalousie_wohnzimmer_west_last_state
#               data:
#                 value: 2
#             - action: script.turn_on
#               target:
#                 entity_id: script.jalousie_wohnzimmer_west_restore_tilt_position

#         # --- Stoppen ---
#         stop_cover:
#           sequence:
#             - action: mqtt.publish
#               data:
#                 topic: "logo/register/set/535"
#                 payload: "10000"
#             - delay: "00:00:0.2"
#             - action: script.turn_on
#               target:
#                 entity_id: script.jalousie_wohnzimmer_west_restore_tilt_position

#         # --- Auf Position fahren ---
#         set_cover_position:
#           sequence:
#             - action: mqtt.publish
#               data:
#                 topic: "logo/register/set/535"
#                 payload: "10000"
#             - delay: "00:00:0.2"
#             - action: mqtt.publish
#               data:
#                 topic: "logo/register/set/535"
#                 payload: "{{ (position | float(0) / 100 * 552) | int }}"
#             - delay: "00:00:0.5"
#             - action: input_number.set_value
#               entity_id: input_number.jalousie_wohnzimmer_west_last_state
#               data:
#                 value: >
#                   {% set pos = (position | float(0) / 100 * 552) | int(0) %}
#                   {% set raw = states('sensor.mosquitto_broker_mqtt_logo_hr_104_position_raw') | int(0) %}
#                   {% set diff = pos - raw %}
#                   {{ (3 if diff > 0 else 2) | int }}
#             - action: script.turn_on
#               target:
#                 entity_id: script.jalousie_wohnzimmer_west_restore_tilt_position
